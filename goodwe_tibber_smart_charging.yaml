blueprint:
  name: GoodWe & Tibber Smart Charging (Automatisiertes Laden & Eigenverbrauch)
  description: |
    Steuert deinen GoodWe Batteriespeicher intelligent basierend auf dynamischen Tibber-Strompreisen.
    Der Akku wird automatisch in den günstigsten Stunden (unter Berücksichtigung eines Preis-Limits) geladen und dient sonst dem Eigenverbrauch (kein Export ins Netz).
    
    **Funktionen:**
    - Erkennt die günstigsten Stunden aus Tibber-Preisen für HEUTE und MORGEN.
    - Lädt nur, wenn der Preis unter einem einstellbaren Limit liegt.
    - Nutzt den "Backup"-Modus zum Laden und den "General"-Modus für Eigenverbrauch.
    - Aktiviert den GoodWe "Fast Charging Switch" während des Ladens (da das Laden auf 3.5kW begrenzt ist).
    - Berücksichtigt die benötigte Ladedauer des Akkus (Konfiguration über Helfer).

    **Voraussetzungen:**
    - HACS GoodWe Integration (für Steuerung des Arbeitsmodus und Fast Charging Switch).
    - Ein funktionierender Tibber REST-Sensor (`sensor.tibber_preise_prognose`), der die Attribute 'today' und 'tomorrow' liefert.

  domain: automation
  source_url: https://your-blog.de/goodwe-tibber-automation
  input:
    tibber_price_sensor:
      name: Tibber Preis Sensor (REST)
      description: Dein Tibber Preis Sensor, der die Attribute 'today' und 'tomorrow' liefert (z.B. sensor.tibber_preise_prognose).
      selector:
        entity:
          domain: sensor # Nur Sensoren anzeigen
    goodwe_pv_power_sensor:
      name: GoodWe PV Power Sensor
      description: Sensor für die aktuelle PV-Leistung deines GoodWe Wechselrichters (z.B. sensor.goodwe_pv_power).
      selector:
        entity:
          domain: sensor
          device_class: power
    goodwe_battery_soc_sensor:
      name: GoodWe Battery SOC Sensor
      description: Sensor für den aktuellen Ladestand deines GoodWe Akkus in Prozent (z.B. sensor.goodwe_battery_soc).
      selector:
        entity:
          domain: sensor
          device_class: battery
    goodwe_work_mode_selector:
      name: GoodWe Work Mode Selector
      description: Die Entität zur Steuerung des Arbeitsmodus deines GoodWe Wechselrichters (z.B. select.goodwe_work_mode).
      selector:
        entity:
          domain: select
          # integration: goodwe_inverter # Dieser Filter ist auch riskant, da Integrationen unterschiedlich heißen können. Besser weglassen.
    goodwe_fast_charging_switch:
      name: GoodWe Fast Charging Switch
      description: Der Schalter für die Schnellladefunktion deines GoodWe Wechselrichters (z.B. switch.goodwe_fast_charging_switch).
      selector:
        entity:
          domain: switch
