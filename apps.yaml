tibber_smart_charge:
  module: tibber_smart_charge_app
  class: TibberSmartCharge
  
  # --- Live Sensoren ---
  tibber_price_sensor_id: sensor.tibber_preise_vorhersage_rest # Dein neuer REST Sensor
  current_soc_sensor_id: sensor.battery_state_of_charge
  goodwe_operation_mode_entity_id: select.inverter_operation_mode
  
  # --- PV Prognosen ---
  pv_forecast_sensor_id: sensor.energy_next_hour
  pv_forecast_current_hour_sensor_id: sensor.energy_current_hour
  pv_forecast_today_remaining_sensor_id: sensor.energy_production_today_remaining
  pv_peak_time_sensor_id: sensor.power_highest_peak_time_today # ISO Format
  
  # --- Power Sensoren ---
  current_pv_power_sensor_id: sensor.pv_power
  battery_power_sensor_id: sensor.battery_power
  grid_power_import_export_sensor_id: sensor.active_power_total
  current_house_consumption_w_id: sensor.house_consumption

  # --- Einstellungen ---
  battery_efficiency_factor: 0.90
  pv_forecast_safety_factor: 0.50
  min_price_spread_eur: 0.08 # Mindestabstand zum Peak, um "Hold" zu aktivieren
  
  # --- Verkn√ºpfung zu deinen Helfern ---
  battery_capacity_kwh_id: input_number.batteriekapazitaet_kwh
  charger_power_kw_id: input_number.ladeleistung_kw
  ladeziel_soc_prozent_id: input_number.ladeziel_soc_prozent
  tibber_discharge_threshold_eur_per_kwh_id: input_number.tibber_entladeschwelle_eur_per_kwh
  min_soc_for_discharge_prozent_id: number.depth_of_discharge_on_grid # Oder Input Number
  charge_intervals_input_id: input_number.anzahl_guenstigste_ladestunden
  referenz_strompreis_id: input_number.referenz_strompreis_ohne_optimierung_eur_per_kwh
  
  # --- Status & Tracking ---
  dashboard_status_text_id: input_text.tibber_smart_charge_status
  app_enabled_switch_id: input_boolean.tibber_smart_charge_app_aktiv
  cheap_hour_toggle_id: input_boolean.tibber_guenstige_ladestunde
  next_charge_time_id: input_text.tibber_next_charge_time
  cheap_hours_text_id: input_text.gunstigsten_ladestunden
  monatsbericht_id: input_text.tibber_smart_charge_monatsbericht

  # Tracking Nummern
  kosten_monat_id: input_number.tibber_smart_charge_kosten_monat
  ersparnis_monat_id: input_number.tibber_smart_charge_ersparnis_monat
  discharge_ersparnis_monat_id: input_number.tibber_smart_discharge_ersparnis_monat
  geladene_kwh_monat_id: input_number.tibber_smart_charge_geladene_kwh_monat
  pv_savings_monat_id: input_number.tibber_smart_pv_savings_monat
  
  kosten_gesamt_id: input_number.tibber_smart_charge_kosten_gesamt
  ersparnis_gesamt_id: input_number.tibber_charge_ersparnis_lifetime_final
  discharge_ersparnis_gesamt_id: input_number.tibber_smart_discharge_ersparnis_gesamt
  geladene_kwh_gesamt_id: input_number.tibber_smart_charge_geladene_kwh_gesamt
  pv_savings_gesamt_id: input_number.tibber_smart_pv_savings_gesamt

  # --- Debugging ---
  debug_mode: false # false = Inverter schaltet wirklich! true = Simulation
  log_debug_level: true
